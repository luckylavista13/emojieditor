<!DOCTYPE html>
<html>
<head>
  <title>Ultimate Emoji Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --primary: #7e57c2;
      --secondary: #ff7043;
      --accent: #26a69a;
    }
    
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }
    
    body {
      background: #f5f5f5;
      margin: 0;
      padding: 15px;
      color: #333;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .header {
      background: var(--primary);
      color: white;
      padding: 20px;
      text-align: center;
    }
    
    .header h1 {
      margin: 0;
      font-weight: 600;
    }
    
    .editor-container {
      display: flex;
      flex-direction: column;
    }
    
    @media (min-width: 768px) {
      .editor-container {
        flex-direction: row;
      }
    }
    
    .preview-panel {
      flex: 1;
      padding: 30px;
      background: #fafafa;
      border-right: 1px solid #eee;
      text-align: center;
    }
    
    .preview-title {
      font-weight: 500;
      color: var(--primary);
      margin-bottom: 20px;
    }
    
    canvas {
      background: white;
      border: 2px dashed #e0e0e0;
      border-radius: 10px;
      max-width: 100%;
      box-shadow: 0 3px 15px rgba(0,0,0,0.05);
    }
    
    .controls-panel {
      flex: 1;
      padding: 25px;
      overflow-y: auto;
      max-height: 600px;
    }
    
    .control-section {
      margin-bottom: 30px;
      border-bottom: 1px solid #eee;
      padding-bottom: 20px;
    }
    
    .control-section:last-child {
      border-bottom: none;
    }
    
    .section-title {
      font-weight: 500;
      color: var(--primary);
      margin-bottom: 15px;
      font-size: 18px;
      display: flex;
      align-items: center;
    }
    
    .section-title::before {
      content: "";
      display: inline-block;
      width: 10px;
      height: 10px;
      background: var(--primary);
      border-radius: 50%;
      margin-right: 10px;
    }
    
    .control-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-size: 15px;
      color: #555;
    }
    
    input[type="color"] {
      width: 50px;
      height: 50px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      cursor: pointer;
    }
    
    input[type="range"] {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: #e0e0e0;
      outline: none;
      -webkit-appearance: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    select {
      width: 100%;
      padding: 12px 15px;
      border-radius: 10px;
      border: 2px solid #e0e0e0;
      background: white;
      font-size: 15px;
      color: #333;
      outline: none;
      transition: all 0.2s;
    }
    
    select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(126, 87, 194, 0.2);
    }
    
    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 30px;
    }
    
    button {
      flex: 1;
      padding: 15px;
      border-radius: 10px;
      border: none;
      font-weight: 500;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .primary-btn {
      background: var(--primary);
      color: white;
    }
    
    .secondary-btn {
      background: var(--secondary);
      color: white;
    }
    
    .accent-btn {
      background: var(--accent);
      color: white;
    }
    
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .emoji-presets {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    
    .emoji-preset {
      font-size: 28px;
      text-align: center;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      background: #f5f5f5;
    }
    
    .emoji-preset:hover {
      background: #e0e0e0;
      transform: scale(1.15);
    }
    
    .saved-emojis {
      margin-top: 30px;
    }
    
    .saved-title {
      font-weight: 500;
      color: var(--primary);
      margin-bottom: 15px;
    }
    
    #emojiGallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
    }
    
    .saved-emoji {
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
    }
    
    .saved-emoji:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .saved-emoji img {
      max-width: 100%;
      height: auto;
      border-radius: 5px;
    }
    
    .emoji-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    
    .emoji-actions button {
      padding: 6px;
      font-size: 12px;
    }
    
    .share-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: center;
    }
    
    .share-btn {
      padding: 10px 15px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .twitter-btn {
      background: #1DA1F2;
    }
    
    .facebook-btn {
      background: #4267B2;
    }
    
    .whatsapp-btn {
      background: #25D366;
    }
    
    .share-icon {
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Ultimate Emoji Editor</h1>
    </div>
    
    <div class="editor-container">
      <div class="preview-panel">
        <div class="preview-title">Preview</div>
        <canvas id="emojiCanvas" width="450" height="450"></canvas>
        
        <!-- Share Buttons -->
        <div class="share-buttons">
          <button class="share-btn twitter-btn" id="twitterShare">
            <span class="share-icon">üê¶</span>
            <span>Twitter</span>
          </button>
          <button class="share-btn facebook-btn" id="facebookShare">
            <span class="share-icon">üëç</span>
            <span>Facebook</span>
          </button>
          <button class="share-btn whatsapp-btn" id="whatsappShare">
            <span class="share-icon">üì±</span>
            <span>WhatsApp</span>
          </button>
        </div>
      </div>
      
      <div class="controls-panel">
        <div class="control-section">
          <div class="section-title">Face</div>
          
          <div class="control-group">
            <label>Face Color</label>
            <input type="color" id="faceColor" value="#FFD700">
          </div>
          
          <div class="control-group">
            <label>Face Shape</label>
            <select id="faceShape">
              <option value="circle">Circle</option>
              <option value="square">Square</option>
              <option value="heart">Heart ‚ù§Ô∏è</option>
              <option value="blob">Blob</option>
              <option value="star">Star</option>
              <option value="hexagon">Hexagon</option>
              <option value="diamond">Diamond</option>
              <option value="cloud">Cloud</option>
              <option value="egg">Egg</option>
            </select>
          </div>
          
          <div class="control-group">
            <label>Face Size</label>
            <input type="range" id="faceSize" min="50" max="200" value="150">
          </div>
        </div>
        
        <div class="control-section">
          <div class="section-title">Eyes</div>
          
          <div class="control-group">
            <label>Eye Type</label>
            <select id="eyeType">
              <option value="happy">Happy</option>
              <option value="sad">Sad</option>
              <option value="angry">Angry</option>
              <option value="wink">Wink</option>
              <option value="hearts">Hearts ‚ù§Ô∏è</option>
              <option value="stars">Stars ‚ú®</option>
              <option value="default">Default</option>
              <option value="emoji">Emoji Eyes</option>
            </select>
          </div>
          
          <div class="control-group">
            <label>Eye Color</label>
            <input type="color" id="eyeColor" value="#000000">
          </div>
          
          <div class="control-group">
            <label>Eye Size</label>
            <input type="range" id="eyeSize" min="5" max="30" value="15">
          </div>
          
          <div class="control-group" id="emojiEyesGroup" style="display:none;">
            <label>Select Eye Emoji</label>
            <div class="emoji-presets eye-presets">
              <div class="emoji-preset" data-eye="üòä">üòä</div>
              <div class="emoji-preset" data-eye="üòç">üòç</div>
              <div class="emoji-preset" data-eye="üòé">üòé</div>
              <div class="emoji-preset" data-eye="ü§©">ü§©</div>
              <div class="emoji-preset" data-eye="ü•∫">ü•∫</div>
              <div class="emoji-preset" data-eye="üëÄ">üëÄ</div>
              <div class="emoji-preset" data-eye="üò≥">üò≥</div>
              <div class="emoji-preset" data-eye="üòå">üòå</div>
              <div class="emoji-preset" data-eye="üòè">üòè</div>
              <div class="emoji-preset" data-eye="üòí">üòí</div>
              <div class="emoji-preset" data-eye="üò™">üò™</div>
              <div class="emoji-preset" data-eye="ü§™">ü§™</div>
            </div>
          </div>
        </div>
        
        <div class="control-section">
          <div class="section-title">Mouth</div>
          
          <div class="control-group">
            <label>Mouth Type</label>
            <select id="mouthType">
              <option value="smile">Smile</option>
              <option value="teeth">Teeth üòÅ</option>
              <option value="frown">Frown</option>
              <option value="open">Open</option>
              <option value="surprised">Surprised</option>
              <option value="tongue">Tongue</option>
              <option value="emoji">Emoji Mouth</option>
            </select>
          </div>
          
          <div class="control-group">
            <label>Mouth Color</label>
            <input type="color" id="mouthColor" value="#000000">
          </div>
          
          <div class="control-group">
            <label>Mouth Size</label>
            <input type="range" id="mouthSize" min="10" max="50" value="30">
          </div>
          
          <div class="control-group" id="emojiMouthGroup" style="display:none;">
            <label>Select Mouth Emoji</label>
            <div class="emoji-presets mouth-presets">
              <div class="emoji-preset" data-mouth="üòÇ">üòÇ</div>
              <div class="emoji-preset" data-mouth="üòò">üòò</div>
              <div class="emoji-preset" data-mouth="üòõ">üòõ</div>
              <div class="emoji-preset" data-mouth="üòú">üòú</div>
              <div class="emoji-preset" data-mouth="üòã">üòã</div>
              <div class="emoji-preset" data-mouth="ü§ë">ü§ë</div>
              <div class="emoji-preset" data-mouth="üò¨">üò¨</div>
              <div class="emoji-preset" data-mouth="üòë">üòë</div>
              <div class="emoji-preset" data-mouth="üòÆ">üòÆ</div>
              <div class="emoji-preset" data-mouth="üòØ">üòØ</div>
              <div class="emoji-preset" data-mouth="üò¥">üò¥</div>
              <div class="emoji-preset" data-mouth="üòµ">üòµ</div>
            </div>
          </div>
        </div>
        
        <div class="control-section">
          <div class="section-title">Extras</div>
          
          <div class="control-group">
            <label>Accessory</label>
            <select id="accessory">
              <option value="none">None</option>
              <option value="glasses">Glasses</option>
              <option value="hat">Hat</option>
              <option value="halo">Halo</option>
              <option value="crown">Crown</option>
              <option value="mustache">Mustache</option>
              <option value="emoji">Emoji Accessory</option>
            </select>
          </div>
          
          <div class="control-group" id="emojiAccessoryGroup" style="display:none;">
            <label>Select Accessory Emoji</label>
            <div class="emoji-presets accessory-presets">
              <div class="emoji-preset" data-accessory="üëì">üëì</div>
              <div class="emoji-preset" data-accessory="üé©">üé©</div>
              <div class="emoji-preset" data-accessory="üëë">üëë</div>
              <div class="emoji-preset" data-accessory="üíç">üíç</div>
              <div class="emoji-preset" data-accessory="üå∫">üå∫</div>
              <div class="emoji-preset" data-accessory="üï∂Ô∏è">üï∂Ô∏è</div>
              <div class="emoji-preset" data-accessory="üéß">üéß</div>
              <div class="emoji-preset" data-accessory="üéÄ">üéÄ</div>
              <div class="emoji-preset" data-accessory="üß¢">üß¢</div>
              <div class="emoji-preset" data-accessory="üëí">üëí</div>
              <div class="emoji-preset" data-accessory="üíÑ">üíÑ</div>
              <div class="emoji-preset" data-accessory="üíã">üíã</div>
            </div>
          </div>
          
          <div class="control-group">
            <label>Background Color</label>
            <input type="color" id="bgColor" value="#FFFFFF">
          </div>
        </div>
        
        <div class="button-group">
          <button class="secondary-btn" id="randomBtn">Random</button>
          <button class="accent-btn" id="saveBtn">Save</button>
          <button class="primary-btn" id="downloadBtn">Download</button>
        </div>
        
        <div class="saved-emojis">
          <div class="saved-title">Your Saved Emojis</div>
          <div id="emojiGallery"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const canvas = document.getElementById("emojiCanvas");
    const ctx = canvas.getContext("2d");
    const faceColor = document.getElementById("faceColor");
    const faceShape = document.getElementById("faceShape");
    const faceSize = document.getElementById("faceSize");
    const eyeType = document.getElementById("eyeType");
    const eyeColor = document.getElementById("eyeColor");
    const eyeSize = document.getElementById("eyeSize");
    const mouthType = document.getElementById("mouthType");
    const mouthColor = document.getElementById("mouthColor");
    const mouthSize = document.getElementById("mouthSize");
    const accessory = document.getElementById("accessory");
    const bgColor = document.getElementById("bgColor");
    const randomBtn = document.getElementById("randomBtn");
    const saveBtn = document.getElementById("saveBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const emojiGallery = document.getElementById("emojiGallery");
    const emojiEyesGroup = document.getElementById("emojiEyesGroup");
    const emojiMouthGroup = document.getElementById("emojiMouthGroup");
    const emojiAccessoryGroup = document.getElementById("emojiAccessoryGroup");
    const twitterShare = document.getElementById("twitterShare");
    const facebookShare = document.getElementById("facebookShare");
    const whatsappShare = document.getElementById("whatsappShare");

    // State
    let emojis = JSON.parse(localStorage.getItem("savedEmojis")) || [];
    let selectedEyeEmoji = "üòä";
    let selectedMouthEmoji = "üòÇ";
    let selectedAccessoryEmoji = "üëì";

    // Initialize
    setCanvasSize();
    drawEmoji();
    renderSavedEmojis();
    window.addEventListener('resize', setCanvasSize);

    // Set canvas size
    function setCanvasSize() {
      const displayWidth = document.querySelector('.preview-panel').clientWidth - 60;
      canvas.width = Math.min(450, displayWidth);
      canvas.height = canvas.width;
      drawEmoji();
    }

    // Perfect heart shape
    function drawHeart(x, y, size) {
      ctx.save();
      ctx.beginPath();
      const topCurveHeight = size * 0.3;
      ctx.moveTo(x, y + topCurveHeight);
      
      // Left curve
      ctx.bezierCurveTo(
        x, y - size * 0.1,
        x - size * 0.5, y - size * 0.1,
        x - size * 0.5, y + size * 0.3
      );
      
      // Bottom left curve
      ctx.bezierCurveTo(
        x - size * 0.5, y + size * 0.7,
        x, y + size * 0.9,
        x, y + size * 0.7
      );
      
      // Bottom right curve
      ctx.bezierCurveTo(
        x, y + size * 0.9,
        x + size * 0.5, y + size * 0.7,
        x + size * 0.5, y + size * 0.3
      );
      
      // Right curve
      ctx.bezierCurveTo(
        x + size * 0.5, y - size * 0.1,
        x, y - size * 0.1,
        x, y + topCurveHeight
      );
      
      ctx.fill();
      ctx.stroke();
      ctx.restore();
    }

    // Star shape
    function drawStar(x, y, radius) {
      ctx.save();
      ctx.beginPath();
      
      const spikes = 5;
      const outerRadius = radius;
      const innerRadius = radius * 0.4;
      
      let rot = Math.PI/2 * 3;
      const step = Math.PI / spikes;
      
      ctx.moveTo(x, y - outerRadius);
      
      for(let i = 0; i < spikes; i++) {
        // Outer point
        const outerX = x + Math.cos(rot) * outerRadius;
        const outerY = y + Math.sin(rot) * outerRadius;
        ctx.lineTo(outerX, outerY);
        rot += step;
        
        // Inner point
        const innerX = x + Math.cos(rot) * innerRadius;
        const innerY = y + Math.sin(rot) * innerRadius;
        ctx.lineTo(innerX, innerY);
        rot += step;
      }
      
      ctx.lineTo(x, y - outerRadius);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
      ctx.restore();
    }

    // Blob shape
    function drawBlob(x, y, radius) {
      ctx.save();
      ctx.beginPath();
      
      // Start at top center
      ctx.moveTo(x, y - radius);
      
      // Create blob-like shape with bezier curves
      const points = 8;
      for(let i = 0; i < points; i++) {
        const angle = (i / points) * Math.PI * 2;
        const nextAngle = ((i + 1) / points) * Math.PI * 2;
        
        // Randomize the radius a bit for blob effect
        const pointRadius = radius * (0.9 + Math.random() * 0.2);
        const nextPointRadius = radius * (0.9 + Math.random() * 0.2);
        
        const x1 = x + Math.cos(angle) * pointRadius;
        const y1 = y + Math.sin(angle) * pointRadius;
        const x2 = x + Math.cos(nextAngle) * nextPointRadius;
        const y2 = y + Math.sin(nextAngle) * nextPointRadius;
        
        // Control points for smooth curves
        const cp1x = x + Math.cos(angle + Math.PI/points) * pointRadius * 1.3;
        const cp1y = y + Math.sin(angle + Math.PI/points) * pointRadius * 1.3;
        const cp2x = x + Math.cos(nextAngle - Math.PI/points) * nextPointRadius * 1.3;
        const cp2y = y + Math.sin(nextAngle - Math.PI/points) * nextPointRadius * 1.3;
        
        ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x2, y2);
      }
      
      ctx.fill();
      ctx.stroke();
      ctx.restore();
    }

    // Hexagon shape
    function drawHexagon(x, y, radius) {
      ctx.save();
      ctx.beginPath();
      
      const sides = 6;
      const angle = (Math.PI * 2) / sides;
      
      ctx.moveTo(x + radius * Math.cos(0), y + radius * Math.sin(0));
      
      for (let i = 1; i <= sides; i++) {
        ctx.lineTo(
          x + radius * Math.cos(angle * i),
          y + radius * Math.sin(angle * i)
        );
      }
      
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
      ctx.restore();
    }

    // Diamond shape
    function drawDiamond(x, y, size) {
      ctx.save();
      ctx.beginPath();
      
      ctx.moveTo(x, y - size);
      ctx.lineTo(x + size * 0.7, y);
      ctx.lineTo(x, y + size);
      ctx.lineTo(x - size * 0.7, y);
      ctx.closePath();
      
      ctx.fill();
      ctx.stroke();
      ctx.restore();
    }

    // Cloud shape
    function drawCloud(x, y, size) {
      ctx.save();
      ctx.beginPath();
      
      // Main cloud body
      ctx.arc(x, y, size * 0.6, Math.PI * 0.5, Math.PI * 1.5);
      ctx.arc(x + size * 0.4, y - size * 0.1, size * 0.4, Math.PI * 1.35, Math.PI * 1.85);
      ctx.arc(x + size * 0.4, y + size * 0.2, size * 0.5, Math.PI * 1.7, Math.PI * 0.4);
      ctx.arc(x - size * 0.2, y + size * 0.1, size * 0.5, Math.PI * 0.4, Math.PI * 1.5);
      
      ctx.fill();
      ctx.stroke();
      ctx.restore();
    }

    // Egg shape
    function drawEgg(x, y, size) {
      ctx.save();
      ctx.beginPath();
      
      ctx.ellipse(x, y, size * 0.6, size * 0.8, 0, 0, Math.PI * 2);
      
      ctx.fill();
      ctx.stroke();
      ctx.restore();
    }

    // Draw emoji
    function drawEmoji() {
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Set background
      ctx.fillStyle = bgColor.value;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const faceRadius = parseInt(faceSize.value) * canvas.width / 400;
      
      // Draw face
      ctx.fillStyle = faceColor.value;
      ctx.strokeStyle = "#000";
      ctx.lineWidth = 2;
      
      switch(faceShape.value) {
        case "circle":
          ctx.beginPath();
          ctx.arc(centerX, centerY, faceRadius, 0, Math.PI * 2);
          ctx.fill();
          ctx.stroke();
          break;
          
        case "square":
          ctx.beginPath();
          ctx.roundRect(centerX - faceRadius, centerY - faceRadius, faceRadius * 2, faceRadius * 2, 30);
          ctx.fill();
          ctx.stroke();
          break;
          
        case "heart":
          drawHeart(centerX, centerY, faceRadius);
          break;
          
        case "star":
          drawStar(centerX, centerY, faceRadius);
          break;
          
        case "blob":
          drawBlob(centerX, centerY, faceRadius);
          break;
          
        case "hexagon":
          drawHexagon(centerX, centerY, faceRadius);
          break;
          
        case "diamond":
          drawDiamond(centerX, centerY, faceRadius);
          break;
          
        case "cloud":
          drawCloud(centerX, centerY, faceRadius);
          break;
          
        case "egg":
          drawEgg(centerX, centerY, faceRadius);
          break;
      }
      
      // Draw eyes
      drawEyes();
      
      // Draw mouth
      drawMouth();
      
      // Draw accessory
      drawAccessory();
    }

    // Draw eyes
    function drawEyes() {
      const eyeRadius = parseInt(eyeSize.value) * canvas.width / 400;
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const eyeXOffset = faceSize.value * canvas.width / 400 * 0.3;
      const eyeY = centerY - faceSize.value * canvas.width / 400 * 0.2;
      
      ctx.fillStyle = eyeColor.value;
      ctx.strokeStyle = eyeColor.value;
      
      switch(eyeType.value) {
        case "happy":
          // Happy eyes (semi-circles)
          ctx.beginPath();
          ctx.arc(centerX - eyeXOffset, eyeY, eyeRadius, 0, Math.PI);
          ctx.stroke();
          ctx.beginPath();
          ctx.arc(centerX + eyeXOffset, eyeY, eyeRadius, 0, Math.PI);
          ctx.stroke();
          break;
          
        case "sad":
          // Sad eyes (dots)
          ctx.beginPath();
          ctx.arc(centerX - eyeXOffset, eyeY, eyeRadius * 0.7, 0, Math.PI * 2);
          ctx.fill();
          ctx.beginPath();
          ctx.arc(centerX + eyeXOffset, eyeY, eyeRadius * 0.7, 0, Math.PI * 2);
          ctx.fill();
          break;
          
        case "angry":
          // Angry eyes (slanted lines)
          ctx.lineWidth = 3;
          ctx.beginPath();
          ctx.moveTo(centerX - eyeXOffset - eyeRadius, eyeY - eyeRadius);
          ctx.lineTo(centerX - eyeXOffset + eyeRadius, eyeY + eyeRadius);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(centerX + eyeXOffset - eyeRadius, eyeY - eyeRadius);
          ctx.lineTo(centerX + eyeXOffset + eyeRadius, eyeY + eyeRadius);
          ctx.stroke();
          break;
          
        case "wink":
          // Wink (one open, one closed)
          ctx.beginPath();
          ctx.arc(centerX - eyeXOffset, eyeY, eyeRadius * 0.7, 0, Math.PI * 2);
          ctx.fill();
          ctx.beginPath();
          ctx.moveTo(centerX + eyeXOffset - eyeRadius, eyeY);
          ctx.lineTo(centerX + eyeXOffset + eyeRadius, eyeY);
          ctx.stroke();
          break;
          
        case "hearts":
          // Heart eyes
          ctx.fillStyle = "red";
          drawHeart(centerX - eyeXOffset, eyeY, eyeRadius * 1.5);
          drawHeart(centerX + eyeXOffset, eyeY, eyeRadius * 1.5);
          break;
          
        case "stars":
          // Star eyes
          ctx.fillStyle = "gold";
          drawStar(centerX - eyeXOffset, eyeY, eyeRadius * 1.2);
          drawStar(centerX + eyeXOffset, eyeY, eyeRadius * 1.2);
          break;
          
        case "default":
          // Default eyes (simple dots)
          ctx.beginPath();
          ctx.arc(centerX - eyeXOffset, eyeY, eyeRadius * 0.7, 0, Math.PI * 2);
          ctx.fill();
          ctx.beginPath();
          ctx.arc(centerX + eyeXOffset, eyeY, eyeRadius * 0.7, 0, Math.PI * 2);
          ctx.fill();
          break;
          
        case "emoji":
          // Emoji eyes
          ctx.font = `${eyeRadius * 2.5}px Arial`;
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(selectedEyeEmoji, centerX - eyeXOffset, eyeY);
          ctx.fillText(selectedEyeEmoji, centerX + eyeXOffset, eyeY);
          break;
      }
    }

    // Draw mouth
    function drawMouth() {
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const mouthWidth = parseInt(mouthSize.value) * canvas.width / 400 * 0.6;
      const mouthY = centerY + faceSize.value * canvas.width / 400 * 0.3;
      
      ctx.strokeStyle = mouthColor.value;
      ctx.fillStyle = mouthColor.value;
      ctx.lineWidth = 3;
      
      switch(mouthType.value) {
        case "smile":
          // Smile (arc)
          ctx.beginPath();
          ctx.arc(centerX, mouthY, mouthWidth * 0.5, 0, Math.PI);
          ctx.stroke();
          break;
          
        case "teeth":
          // Teeth (smile with teeth)
          ctx.beginPath();
          ctx.arc(centerX, mouthY, mouthWidth * 0.5, 0, Math.PI);
          ctx.stroke();
          
          // Draw teeth
          ctx.fillStyle = "white";
          const teethCount = 8;
          const toothWidth = mouthWidth / teethCount;
          for(let i = 0; i < teethCount; i++) {
            ctx.fillRect(
              centerX - mouthWidth/2 + i * toothWidth, 
              mouthY - 5, 
              toothWidth * 0.9, 
              10
            );
          }
          break;
          
        case "frown":
          // Frown (upside-down arc)
          ctx.beginPath();
          ctx.arc(centerX, mouthY + faceSize.value * canvas.width / 400 * 0.2, mouthWidth * 0.5, Math.PI, 0, true);
          ctx.stroke();
          break;
          
        case "open":
          // Open mouth (circle)
          ctx.beginPath();
          ctx.arc(centerX, mouthY, mouthWidth * 0.4, 0, Math.PI * 2);
          ctx.stroke();
          break;
          
        case "surprised":
          // Surprised (small circle)
          ctx.beginPath();
          ctx.arc(centerX, mouthY, mouthWidth * 0.3, 0, Math.PI * 2);
          ctx.stroke();
          break;
          
        case "tongue":
          // Tongue (smile with tongue)
          ctx.beginPath();
          ctx.arc(centerX, mouthY, mouthWidth * 0.5, 0, Math.PI);
          ctx.stroke();
          
          // Draw tongue
          ctx.fillStyle = "#ff6b6b";
          ctx.beginPath();
          ctx.ellipse(
            centerX, 
            mouthY + 15, 
            mouthWidth * 0.3, 
            20, 
            0, 
            0, 
            Math.PI
          );
          ctx.fill();
          break;
          
        case "emoji":
          // Emoji mouth
          ctx.font = `${mouthWidth * 1.2}px Arial`;
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(selectedMouthEmoji, centerX, mouthY);
          break;
      }
    }

    // Draw accessory
    function drawAccessory() {
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const faceRadius = faceSize.value * canvas.width / 400;
      
      ctx.strokeStyle = "#000";
      ctx.fillStyle = "#000";
      ctx.lineWidth = 2;
      
      switch(accessory.value) {
        case "glasses":
          // Glasses
          const lensSize = faceRadius * 0.4;
          ctx.fillStyle = "#4a6fa5";
          ctx.beginPath();
          ctx.ellipse(centerX - faceRadius * 0.3, centerY - faceRadius * 0.2, lensSize, lensSize * 0.7, 0, 0, Math.PI * 2);
          ctx.fill();
          ctx.stroke();
          
          ctx.beginPath();
          ctx.ellipse(centerX + faceRadius * 0.3, centerY - faceRadius * 0.2, lensSize, lensSize * 0.7, 0, 0, Math.PI * 2);
          ctx.fill();
          ctx.stroke();
          
          // Bridge
          ctx.lineWidth = 4;
          ctx.beginPath();
          ctx.moveTo(centerX - faceRadius * 0.3 + lensSize * 0.8, centerY - faceRadius * 0.2);
          ctx.lineTo(centerX + faceRadius * 0.3 - lensSize * 0.8, centerY - faceRadius * 0.2);
          ctx.stroke();
          
          // Temples
          ctx.beginPath();
          ctx.moveTo(centerX - faceRadius * 0.3 - lensSize * 0.8, centerY - faceRadius * 0.2);
          ctx.lineTo(centerX - faceRadius * 0.6, centerY - faceRadius * 0.1);
          ctx.stroke();
          
          ctx.beginPath();
          ctx.moveTo(centerX + faceRadius * 0.3 + lensSize * 0.8, centerY - faceRadius * 0.2);
          ctx.lineTo(centerX + faceRadius * 0.6, centerY - faceRadius * 0.1);
          ctx.stroke();
          break;
          
        case "hat":
          // Hat
          ctx.fillStyle = "#4a6fa5";
          ctx.beginPath();
          ctx.moveTo(centerX - faceRadius * 0.8, centerY - faceRadius * 0.4);
          ctx.lineTo(centerX + faceRadius * 0.8, centerY - faceRadius * 0.4);
          ctx.lineTo(centerX + faceRadius * 0.5, centerY - faceRadius * 0.9);
          ctx.lineTo(centerX - faceRadius * 0.5, centerY - faceRadius * 0.9);
          ctx.closePath();
          ctx.fill();
          ctx.stroke();
          
          // Brim
          ctx.beginPath();
          ctx.ellipse(centerX, centerY - faceRadius * 0.4, faceRadius * 0.9, faceRadius * 0.2, 0, 0, Math.PI * 2);
          ctx.fill();
          ctx.stroke();
          break;
          
        case "halo":
          // Halo
          ctx.strokeStyle = "gold";
          ctx.lineWidth = 4;
          ctx.beginPath();
          ctx.arc(centerX, centerY - faceRadius * 0.8, faceRadius * 0.6, 0, Math.PI * 2);
          ctx.stroke();
          break;
          
        case "crown":
          // Crown
          ctx.fillStyle = "gold";
          ctx.beginPath();
          ctx.moveTo(centerX - faceRadius * 0.7, centerY - faceRadius * 0.5);
          
          // Draw crown points
          const points = 5;
          for(let i = 0; i <= points; i++) {
            const x = centerX - faceRadius * 0.7 + (i * faceRadius * 1.4) / points;
            const y = i % 2 === 0 ? 
              centerY - faceRadius * 0.5 : 
              centerY - faceRadius * 0.7;
            ctx.lineTo(x, y);
          }
          
          ctx.lineTo(centerX + faceRadius * 0.7, centerY - faceRadius * 0.5);
          ctx.lineTo(centerX + faceRadius * 0.7, centerY - faceRadius * 0.3);
          ctx.lineTo(centerX - faceRadius * 0.7, centerY - faceRadius * 0.3);
          ctx.closePath();
          ctx.fill();
          ctx.stroke();
          break;
          
        case "mustache":
          // Mustache
          ctx.fillStyle = "#333";
          ctx.beginPath();
          ctx.moveTo(centerX - faceRadius * 0.4, centerY + faceRadius * 0.2);
          ctx.quadraticCurveTo(
            centerX - faceRadius * 0.2, centerY + faceRadius * 0.4,
            centerX, centerY + faceRadius * 0.3
          );
          ctx.quadraticCurveTo(
            centerX + faceRadius * 0.2, centerY + faceRadius * 0.4,
            centerX + faceRadius * 0.4, centerY + faceRadius * 0.2
          );
          ctx.quadraticCurveTo(
            centerX + faceRadius * 0.3, centerY + faceRadius * 0.1,
            centerX, centerY + faceRadius * 0.2
          );
          ctx.quadraticCurveTo(
            centerX - faceRadius * 0.3, centerY + faceRadius * 0.1,
            centerX - faceRadius * 0.4, centerY + faceRadius * 0.2
          );
          ctx.fill();
          break;
          
        case "emoji":
          // Emoji accessory
          ctx.font = `${faceRadius * 0.8}px Arial`;
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(selectedAccessoryEmoji, centerX, centerY - faceRadius * 0.8);
          break;
      }
    }

    // Save emoji
    function saveEmoji() {
      const emojiData = {
        faceColor: faceColor.value,
        faceShape: faceShape.value,
        faceSize: faceSize.value,
        eyeType: eyeType.value,
        eyeColor: eyeColor.value,
        eyeSize: eyeSize.value,
        mouthType: mouthType.value,
        mouthColor: mouthColor.value,
        mouthSize: mouthSize.value,
        accessory: accessory.value,
        bgColor: bgColor.value,
        selectedEyeEmoji,
        selectedMouthEmoji,
        selectedAccessoryEmoji,
        timestamp: new Date().getTime(),
        image: canvas.toDataURL()
      };
      
      emojis.push(emojiData);
      localStorage.setItem("savedEmojis", JSON.stringify(emojis));
      renderSavedEmojis();
      
      // Show confirmation
      alert("Emoji saved successfully!");
    }

    // Render saved emojis
    function renderSavedEmojis() {
      emojiGallery.innerHTML = "";
      
      // Sort by newest first
      const sortedEmojis = [...emojis].sort((a, b) => b.timestamp - a.timestamp);
      
      sortedEmojis.forEach((emoji, index) => {
        const emojiElement = document.createElement("div");
        emojiElement.className = "saved-emoji";
        
        emojiElement.innerHTML = `
          <img src="${emoji.image}" alt="Saved Emoji">
          <div class="emoji-actions">
            <button class="load-emoji" data-index="${index}">Load</button>
            <button class="delete-emoji" data-index="${index}">Delete</button>
          </div>
        `;
        
        // Add load button
        emojiElement.querySelector(".load-emoji").addEventListener("click", (e) => {
          e.stopPropagation();
          loadEmoji(emoji);
        });
        
        // Add delete button
        emojiElement.querySelector(".delete-emoji").addEventListener("click", (e) => {
          e.stopPropagation();
          deleteEmoji(index);
        });
        
        emojiGallery.appendChild(emojiElement);
      });
    }

    // Load emoji
    function loadEmoji(emoji) {
      faceColor.value = emoji.faceColor;
      faceShape.value = emoji.faceShape;
      faceSize.value = emoji.faceSize;
      eyeType.value = emoji.eyeType;
      eyeColor.value = emoji.eyeColor;
      eyeSize.value = emoji.eyeSize;
      mouthType.value = emoji.mouthType;
      mouthColor.value = emoji.mouthColor;
      mouthSize.value = emoji.mouthSize || 30; // Default for backward compatibility
      accessory.value = emoji.accessory;
      bgColor.value = emoji.bgColor;
      selectedEyeEmoji = emoji.selectedEyeEmoji || "üòä";
      selectedMouthEmoji = emoji.selectedMouthEmoji || "üòÇ";
      selectedAccessoryEmoji = emoji.selectedAccessoryEmoji || "üëì";
      
      // Update UI
      updateEmojiSelectors();
      drawEmoji();
    }

    // Delete emoji
    function deleteEmoji(index) {
      if (confirm("Delete this emoji?")) {
        emojis.splice(index, 1);
        localStorage.setItem("savedEmojis", JSON.stringify(emojis));
        renderSavedEmojis();
      }
    }

    // Download emoji
    function downloadEmoji() {
      const link = document.createElement("a");
      link.download = `emoji-${new Date().getTime()}.png`;
      link.href = canvas.toDataURL();
      link.click();
    }

    // Share to Twitter
    function shareToTwitter() {
      const text = "Check out this emoji I created!";
      const url = "https://example.com/emoji-editor"; // Replace with your actual URL
      const imageUrl = canvas.toDataURL();
      
      // In a real app, you would upload the image to a server first
      // Then share the public URL
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
    }

    // Share to Facebook
    function shareToFacebook() {
      const url = "https://example.com/emoji-editor"; // Replace with your actual URL
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
    }

    // Share to WhatsApp
    function shareToWhatsApp() {
      const text = "Check out this emoji I created!";
      const url = "https://example.com/emoji-editor"; // Replace with your actual URL
      window.open(`https://wa.me/?text=${encodeURIComponent(text + " " + url)}`, '_blank');
    }

    // Random emoji
    function randomEmoji() {
      const colors = ['#FFD700', '#FF9AA2', '#FFB7B2', '#FFDAC1', '#E2F0CB', '#B5EAD7', '#C7CEEA', '#F8B195', '#F67280', '#C06C84'];
      const shapes = ['circle', 'square', 'heart', 'blob', 'star', 'hexagon', 'diamond', 'cloud', 'egg'];
      const eyes = ['happy', 'sad', 'angry', 'wink', 'hearts', 'stars', 'default', 'emoji'];
      const mouths = ['smile', 'teeth', 'frown', 'open', 'surprised', 'tongue', 'emoji'];
      const accessories = ['none', 'glasses', 'hat', 'halo', 'crown', 'mustache', 'emoji'];
      const eyeEmojis = ['üòä', 'üòç', 'üòé', 'ü§©', 'ü•∫', 'üëÄ', 'üò≥', 'üòå', 'üòè', 'üòí', 'üò™', 'ü§™'];
      const mouthEmojis = ['üòÇ', 'üòò', 'üòõ', 'üòú', 'üòã', 'ü§ë', 'üò¨', 'üòë', 'üòÆ', 'üòØ', 'üò¥', 'üòµ'];
      const accessoryEmojis = ['üëì', 'üé©', 'üëë', 'üíç', 'üå∫', 'üï∂Ô∏è', 'üéß', 'üéÄ', 'üß¢', 'üëí', 'üíÑ', 'üíã'];
      
      faceColor.value = colors[Math.floor(Math.random() * colors.length)];
      faceShape.value = shapes[Math.floor(Math.random() * shapes.length)];
      faceSize.value = Math.floor(Math.random() * 101) + 100;
      eyeType.value = eyes[Math.floor(Math.random() * eyes.length)];
      eyeColor.value = `#${Math.floor(Math.random()*16777215).toString(16)}`;
      eyeSize.value = Math.floor(Math.random() * 16) + 10;
      mouthType.value = mouths[Math.floor(Math.random() * mouths.length)];
      mouthColor.value = `#${Math.floor(Math.random()*16777215).toString(16)}`;
      mouthSize.value = Math.floor(Math.random() * 31) + 20;
      accessory.value = accessories[Math.floor(Math.random() * accessories.length)];
      bgColor.value = `#${Math.floor(Math.random()*16777215).toString(16)}`;
      selectedEyeEmoji = eyeEmojis[Math.floor(Math.random() * eyeEmojis.length)];
      selectedMouthEmoji = mouthEmojis[Math.floor(Math.random() * mouthEmojis.length)];
      selectedAccessoryEmoji = accessoryEmojis[Math.floor(Math.random() * accessoryEmojis.length)];
      
      // Update UI
      updateEmojiSelectors();
      drawEmoji();
    }

    // Update emoji selector visibility
    function updateEmojiSelectors() {
      emojiEyesGroup.style.display = eyeType.value === "emoji" ? "block" : "none";
      emojiMouthGroup.style.display = mouthType.value === "emoji" ? "block" : "none";
      emojiAccessoryGroup.style.display = accessory.value === "emoji" ? "block" : "none";
    }

    // Set eye emoji from preset
    function setEyeEmoji(emoji) {
      selectedEyeEmoji = emoji;
      drawEmoji();
    }

    // Set mouth emoji from preset
    function setMouthEmoji(emoji) {
      selectedMouthEmoji = emoji;
      drawEmoji();
    }

    // Set accessory emoji from preset
    function setAccessoryEmoji(emoji) {
      selectedAccessoryEmoji = emoji;
      drawEmoji();
    }

    // Event listeners
    faceColor.addEventListener("input", drawEmoji);
    faceShape.addEventListener("change", drawEmoji);
    faceSize.addEventListener("input", drawEmoji);
    eyeType.addEventListener("change", () => {
      updateEmojiSelectors();
      drawEmoji();
    });
    eyeColor.addEventListener("input", drawEmoji);
    eyeSize.addEventListener("input", drawEmoji);
    mouthType.addEventListener("change", () => {
      updateEmojiSelectors();
      drawEmoji();
    });
    mouthColor.addEventListener("input", drawEmoji);
    mouthSize.addEventListener("input", drawEmoji);
    accessory.addEventListener("change", () => {
      updateEmojiSelectors();
      drawEmoji();
    });
    bgColor.addEventListener("input", drawEmoji);
    randomBtn.addEventListener("click", randomEmoji);
    saveBtn.addEventListener("click", saveEmoji);
    downloadBtn.addEventListener("click", downloadEmoji);
    twitterShare.addEventListener("click", shareToTwitter);
    facebookShare.addEventListener("click", shareToFacebook);
    whatsappShare.addEventListener("click", shareToWhatsApp);

    // Add click handlers for emoji presets
    document.querySelectorAll(".eye-presets .emoji-preset").forEach(preset => {
      preset.addEventListener("click", () => {
        setEyeEmoji(preset.textContent);
      });
    });
    
    document.querySelectorAll(".mouth-presets .emoji-preset").forEach(preset => {
      preset.addEventListener("click", () => {
        setMouthEmoji(preset.textContent);
      });
    });
    
    document.querySelectorAll(".accessory-presets .emoji-preset").forEach(preset => {
      preset.addEventListener("click", () => {
        setAccessoryEmoji(preset.textContent);
      });
    });

    // Initialize selectors
    updateEmojiSelectors();
  </script>
</body>
  </html>
